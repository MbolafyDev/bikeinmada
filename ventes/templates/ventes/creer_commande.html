{# ========= ventes/partials/commande_create_modal.html ========= #}
<div class="modal fade" id="commandeCreateModal" tabindex="-1" aria-labelledby="commandeCreateModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-dialog-scrollable">
    <div class="modal-content">
      <form method="post" action="{% url 'commande_create' %}">
        {% csrf_token %}

        <div class="modal-header">
          <h5 class="modal-title" id="commandeCreateModalLabel">Créer une commande</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fermer"></button>
        </div>

        <div class="modal-body">
          {% include "includes/messages_alert.html" %}

          <!-- Informations client -->
          <div class="card mb-4">
            <div class="card-header bg-success text-white">Informations sur le client</div>
            <div class="card-body">
              <div class="row g-3">
                <div class="col-md-6">
                  <label for="create_nom" class="form-label">Nom *</label>
                  <input type="text" class="form-control" name="nom" id="create_nom" required>
                </div>
                <div class="col-md-6">
                  <label for="create_contact" class="form-label">Contact *</label>
                  <input type="text" class="form-control" name="contact" id="create_contact" required>
                </div>
                <div class="col-md-6">
                  <label for="create_lieu" class="form-label">Lieu *</label>
                  <select name="lieu" id="create_lieu" class="form-select" required>
                    <option value="" disabled selected>Choisir un lieu</option>
                    {% for l in lieux %}
                      <option value="{{ l.id }}"
                              data-frais_livraison="{{ l.frais_livraison }}"
                              data-frais_livreur="{{ l.frais_livreur }}">{{ l.lieu }}</option>
                    {% endfor %}
                  </select>
                </div>
                <div class="col-md-6">
                  <label for="create_precision_lieu" class="form-label">Précision lieu</label>
                  <input type="text" class="form-control" name="precision_lieu" id="create_precision_lieu">
                </div>
              </div>
            </div>
          </div>

          <!-- Informations livraison -->
          <div class="card mb-4">
            <div class="card-header bg-secondary text-white">Informations sur la livraison</div>
            <div class="card-body">
              <div class="row g-3">
                <div class="col-md-6">
                  <label for="create_date_livraison" class="form-label">Date de livraison</label>
                  <input type="date" class="form-control" name="date_livraison" id="create_date_livraison">
                </div>
                <div class="col-md-6">
                  <label for="create_remarque" class="form-label">Remarque</label>
                  <input type="text" class="form-control" name="remarque" id="create_remarque">
                </div>
                <div class="col-md-6">
                  <label for="create_date_debut_prestation" class="form-label">Date début de prestation</label>
                  <input type="date" class="form-control" name="date_debut_prestation" id="create_date_debut_prestation" value="{{ date_du_jour }}">
                </div>
                <div class="col-md-6">
                  <label for="create_date_fin_prestation" class="form-label">Date fin de prestation</label>
                  <input type="date" class="form-control" name="date_fin_prestation" id="create_date_fin_prestation" value="{{ date_du_jour }}">
                </div>
                <div class="col-md-6">
                  <label for="create_frais_livraison" class="form-label">Frais de livraison</label>
                  <input type="text" class="form-control" name="frais_livraison" id="create_frais_livraison">
                </div>
                <div class="col-md-6">
                  <label for="create_frais_livreur" class="form-label">Frais livreur</label>
                  <input type="text" class="form-control" name="frais_livreur" id="create_frais_livreur">
                </div>
              </div>
            </div>
          </div>

          <!-- Informations commande / Lignes -->
          <div class="card mb-4">
            <div class="card-header bg-info text-white d-flex justify-content-between align-items-center">
              Informations sur la commande
            </div>
            <div class="card-body">
              <div class="row g-3">
                <div class="col-md-6">
                  <label for="create_date_commande" class="form-label">Date de commande</label>
                  <input type="date" class="form-control" name="date_commande" id="create_date_commande" value="{{ date_du_jour }}" required>
                </div>
                <div class="col-md-6">
                  <label for="create_page" class="form-label">Page</label>
                  <select name="page" id="create_page" class="form-select" required>
                    <option value="">-- Choisir une page --</option>
                    {% for p in pages %}
                      <option value="{{ p.id }}">{{ p.nom }}</option>
                    {% endfor %}
                  </select>
                </div>
              </div>

              <hr class="my-4">

              <div id="create_lignesCommande"></div>
              <button type="button" class="btn btn-sm btn-outline-success my-2" data-action="add-line">+ Ajouter un article</button>

              <hr class="my-4">

              <!-- Récap totaux en pleine largeur -->
              <div class="row">
                <div class="col-12">
                  <table class="table table-bordered w-100 mb-0">
                    <tbody>
                      <tr>
                        <th>Total des articles</th>
                        <td class="text-end"><span data-name="total_articles">0</span> Ar</td>
                      </tr>
                      <tr>
                        <th>Frais de livraison</th>
                        <td class="text-end"><span data-name="total_frais_livraison">0</span> Ar</td>
                      </tr>
                      <tr>
                        <th>Total à payer</th>
                        <td class="fw-bold text-end"><span data-name="total_a_payer">0</span> Ar</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>

            </div>
          </div>
        </div>

        <div class="modal-footer d-flex justify-content-end">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
          <button type="submit" class="btn btn-success">Ajouter</button>
        </div>

      </form>
    </div>
  </div>
</div>





