{# articles/includes/article_table.html #}
{% load nombre %}
{% load static %}

{% if articles %}
  <div class="table-responsive">
    <table class="table table-bordered table-striped align-middle">
      <thead class="table-primary">
        <tr>
          <th>Image</th>
          <th>Nom</th>
          <th>Réf.</th>
          <th class="text-end">P.A</th>
          <th class="text-end">P.V</th>
          <th class="text-center">Livraison</th>
          <th class="text-center">Action</th>
        </tr>
      </thead>
      <tbody>
        {% for article in articles %}
        <tr {% if article.statut_publication == 'supprimé' %}style="text-decoration: line-through;"{% endif %}>
          <td class="text-center">
            <div class="mx-auto"
                 style="width:40px;height:40px;display:flex;align-items:center;justify-content:center;
                        background:#fff;border-radius:.25rem;overflow:hidden;">
              {% if article.image %}
                <img src="{{ article.image.url }}" alt="{{ article.nom }}"
                     style="max-width:100%;max-height:100%;object-fit:contain;display:block;">
              {% else %}
                <img src="{% static 'images/zarastore.png' %}" alt="{{ article.nom }}"
                     style="max-width:100%;max-height:100%;object-fit:contain;display:block;">
              {% endif %}
            </div>
          </td>
          <td>{{ article.nom }} - taille : {{ article.taille }} - couleur : {{ article.couleur }}</td>
          <td>{{ article.reference }}</td>
          <td class="text-end">{{ article.prix_achat|intpoint }}</td>
          <td class="text-end">{{ article.prix_vente|intpoint }}</td>
          <td class="text-center">{{ article.livraison }}</td>
          <td class="text-center" style="white-space:nowrap">
            <button class="btn btn-sm btn-outline-primary me-1"
                    data-bs-toggle="modal" data-bs-target="#editModal{{ article.id }}"
                    {% if not is_admin or article.statut_publication == 'supprimé' %}disabled{% endif %}>
              <i class="fa fa-edit"></i>
            </button>

            {% if article.statut_publication == "supprimé" and is_admin %}
              <div class="btn-group">
                <button type="button" class="btn btn-sm btn-outline-secondary dropdown-toggle"
                        data-bs-toggle="dropdown" aria-expanded="false">
                  <i class="fa fa-ellipsis-v"></i>
                </button>
                <ul class="dropdown-menu">
                  <li>
                    <a class="dropdown-item text-danger"
                       data-bs-toggle="modal" data-bs-target="#deleteDefModal{{ article.id }}">
                       Suppr. déf.
                    </a>
                  </li>
                  <li>
                    <a class="dropdown-item text-primary"
                       data-bs-toggle="modal" data-bs-target="#restoreModal{{ article.id }}">
                       Restaurer
                    </a>
                  </li>
                </ul>
              </div>
            {% else %}
              <button class="btn btn-sm btn-outline-danger"
                      data-bs-toggle="modal" data-bs-target="#deleteModal{{ article.id }}"
                      {% if not is_admin %}disabled{% endif %}>
                <i class="fa fa-trash"></i>
              </button>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

{% else %}
  <div class="alert alert-info text-center">Aucun article enregistré.</div>
{% endif %}
