<!-- Modal pour crÃ©er un article -->
<div class="modal fade" id="createModal" tabindex="-1" aria-labelledby="createModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <form method="post" action="{% url 'article_create' %}" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="modal-header">
          <h5 class="modal-title" id="createModalLabel">Ajouter un article</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fermer"></button>
        </div>

        <div class="modal-body">
          <div class="row g-3">
            <div class="col-12">
              <label for="nom" class="form-label">Nom</label>
              <input type="text" class="form-control" id="nom" name="nom" required>
            </div>

            <div class="col-md-6">
              <label for="image" class="form-label">Image (optionnel)</label>
              <input type="file" class="form-control" id="image" name="image" accept="image/*"
                     data-preview-target="#preview-create">
              <div class="form-text">Formats: JPG/PNG/WebP. Max conseillÃ©: 3 Mo.</div>
              <!-- AperÃ§u live -->
              <img id="preview-create" class="img-thumbnail mt-2 d-none" style="max-height:150px;" alt="AperÃ§u image">
            </div>

            <div class="col-md-6">
              <label for="reference" class="form-label">RÃ©fÃ©rence</label>
              <input type="text" class="form-control" id="reference" name="reference">
            </div>

            <div class="col-md-4">
              <label for="prix_achat" class="form-label">Prix d'achat</label>
              <input type="number" class="form-control" id="prix_achat" step="100" name="prix_achat">
            </div>

            <div class="col-md-4">
              <label for="prix_vente" class="form-label">Prix de vente</label>
              <input type="number" class="form-control" id="prix_vente" step="100" name="prix_vente">
            </div>

            <div class="col-md-4">
              <label for="livraison" class="form-label">Livraison</label>
              <select class="form-select" id="livraison" name="livraison">
                <option value="Payante" selected>Payante</option>
                <option value="Gratuite">Gratuite</option>
              </select>
            </div>

            <!-- ðŸ‘‡ Nouveaux champs -->
            <div class="col-md-4">
              <label for="categorie" class="form-label">CatÃ©gorie</label>
              <select class="form-select" id="categorie" name="categorie">
                <option value="" selected>â€” Aucune â€”</option>
                {% for c in categories %}
                  <option value="{{ c.id }}">{{ c.categorie }}</option>
                {% endfor %}
              </select>
            </div>

            <div class="col-md-4">
              <label for="taille" class="form-label">Taille</label>
              <select class="form-select" id="taille" name="taille">
                <option value="" selected>â€” Aucune â€”</option>
                {% for t in tailles %}
                  <option value="{{ t.id }}">{{ t.taille }}</option>
                {% endfor %}
              </select>
            </div>

            <div class="col-md-4">
              <label for="couleur" class="form-label">Couleur</label>
              <select class="form-select" id="couleur" name="couleur">
                <option value="" selected>â€” Aucune â€”</option>
                {% for cl in couleurs %}
                  <option value="{{ cl.id }}">{{ cl.couleur }}</option>
                {% endfor %}
              </select>
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
          <button type="submit" class="btn btn-success">Ajouter l'article</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
  // AperÃ§u d'image (recyclable)
  (function () {
    const input = document.getElementById('image');
    if (!input) return;
    input.addEventListener('change', function (e) {
      const targetSel = e.target.getAttribute('data-preview-target');
      const preview = document.querySelector(targetSel);
      if (!preview) return;

      const file = e.target.files && e.target.files[0];
      if (file) {
        preview.classList.remove('d-none');
        preview.src = URL.createObjectURL(file);
      } else {
        preview.classList.add('d-none');
        preview.removeAttribute('src');
      }
    });
  })();
</script>
